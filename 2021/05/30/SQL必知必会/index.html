<!DOCTYPE html>
<html lang="zh-CH">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="光说不做假把式">
  <meta name="author" content="杨玉杰">
  <meta name="keywords" content="">
  <title>SQL必知必会 - 杨玉杰|个人博客</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/agate.min.css" />
  

  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_yg9cfy8wd6.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


<meta name="generator" content="Hexo 4.2.1"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>杨玉杰|个人博客</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                主页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友情链接
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/img/bgi.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
  <div class="mt-3 post-meta">
    <i class="iconfont icon-date-fill" aria-hidden="true"></i>
    <time datetime="2021-05-30 15:35">
      May 30, 2021 pm
    </time>
  </div>


<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      5.9k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      73
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <div class="post-content mx-auto" id="post">
            
            <article class="markdown-body">
              <h1 id="一、了解SQL"><a href="#一、了解SQL" class="headerlink" title="一、了解SQL"></a>一、了解SQL</h1><h2 id="1-1-数据库基础"><a href="#1-1-数据库基础" class="headerlink" title="1.1 数据库基础"></a>1.1 数据库基础</h2><h3 id="1-1-1-数据库"><a href="#1-1-1-数据库" class="headerlink" title="1.1.1 数据库"></a>1.1.1 数据库</h3><p>数据库是一个以某种有组织的方式存储的数据集合。<br>数据库软件应称为数据库管理系统（DBMS）。数据库是通过DBMS创建和操纵的容器。</p>
<h3 id="1-1-2-表"><a href="#1-1-2-表" class="headerlink" title="1.1.2 表"></a>1.1.2 表</h3><p>表（table）是某种特定类型数据的结构化清单，存储在表中的数据是同一种类型的数据或清单。</p>
<h3 id="1-1-3-列和数据类型"><a href="#1-1-3-列和数据类型" class="headerlink" title="1.1.3 列和数据类型"></a>1.1.3 列和数据类型</h3><p>列（column）：表中的一个字段。所有表都是由一个或多个列组成的。<br>数据类型限定了可存储在列中的数据种类，对于优化磁盘使用方面起到重要作用。</p>
<h3 id="1-1-4-行"><a href="#1-1-4-行" class="headerlink" title="1.1.4 行"></a>1.1.4 行</h3><p>表中的数据总是按行存储的。</p>
<h3 id="1-1-5-主键"><a href="#1-1-5-主键" class="headerlink" title="1.1.5 主键"></a>1.1.5 主键</h3><p>唯一标识表中每行的这个列（或这几列）称为主键。<br>    • 任意两行都不具有相同的主键值；<br>    • 每一行都必须具有一个主键值（主键列不允许NULL值）；<br>    • 主键列中的值不允许修改或更新；<br>    • 主键值不能重用（如果某行从表中删除，它的主键不能赋给以后的新行）。</p>
<h2 id="1-2-什么是SQL"><a href="#1-2-什么是SQL" class="headerlink" title="1.2 什么是SQL"></a>1.2 什么是SQL</h2><p>SQL是结构化查询语言（<code>Structured Query Language</code>）的缩写。SQL语句不区分大小写，但是建议SQL关键字大写，表名、列名等小写。</p>
<h1 id="二、检索数据"><a href="#二、检索数据" class="headerlink" title="二、检索数据"></a>二、检索数据</h1><h2 id="2-1-检索单列数据"><a href="#2-1-检索单列数据" class="headerlink" title="2.1 检索单列数据"></a>2.1 检索单列数据</h2><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> prod_name
<span class="hljs-keyword">FROM</span> Products;</code></pre></div>


<p>从<code>Products</code>表中检索一个名为<code>prod_name</code>的列。</p>
<h2 id="2-2-检索多个列"><a href="#2-2-检索多个列" class="headerlink" title="2.2 检索多个列"></a>2.2 检索多个列</h2><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> prod_id, prod_name, prod_price
<span class="hljs-keyword">FROM</span> Products;</code></pre></div>


<p>在<code>SELECT</code>关键字后给出多个列名，列名之间必须以逗号分隔。</p>
<h2 id="2-3-检索所有列"><a href="#2-3-检索所有列" class="headerlink" title="2.3 检索所有列"></a>2.3 检索所有列</h2><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> *
<span class="hljs-keyword">FROM</span> Products;</code></pre></div>

<h2 id="2-4-检索不同的值"><a href="#2-4-检索不同的值" class="headerlink" title="2.4 检索不同的值"></a>2.4 检索不同的值</h2><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> vend_id
<span class="hljs-keyword">FROM</span> Products;</code></pre></div>


<p>使用<code>DISTINCT</code>关键字，指示数据库只返回不同的值。</p>
<h2 id="2-5-限制结果"><a href="#2-5-限制结果" class="headerlink" title="2.5 限制结果"></a>2.5 限制结果</h2><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> TOP <span class="hljs-number">5</span> prod_name
<span class="hljs-keyword">FROM</span> Products;</code></pre></div>

<p>只检索前5行数据</p>
<div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> prod_name
<span class="hljs-keyword">FROM</span> Products
<span class="hljs-keyword">LIMIT</span> <span class="hljs-number">5</span> <span class="hljs-keyword">OFFSET</span> <span class="hljs-number">5</span>;</code></pre></div>

<p><code>LIMIT 5 OFFSET 5</code>指示MySQL等DBMS返回<strong>从第5行起的5行数据</strong>。</p>
<p>第二个数字是指从哪儿开始，第一个数字是检索的行数。</p>
<p>提示：<strong>第一个被检索的行是第0行</strong>，而不是第1行。因此，LIMIT 1 OFFSET 1会检索第2行，而不是第1行。</p>
<h2 id="2-6-使用注释"><a href="#2-6-使用注释" class="headerlink" title="2.6 使用注释"></a>2.6 使用注释</h2><p>注释使用<code>--</code>（两个连字符）嵌在行内。<br>在一行的开始处使用<code>#</code>，这一整行都将作为注释。<br>注释从<code>\*</code>开始，到<code>*/</code>结束，/*和*/之间的任何内容都是注释。</p>
<h1 id="三、排序检索数据"><a href="#三、排序检索数据" class="headerlink" title="三、排序检索数据"></a>三、排序检索数据</h1><h2 id="3-1-排序数据"><a href="#3-1-排序数据" class="headerlink" title="3.1 排序数据"></a>3.1 排序数据</h2><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> prod_name
<span class="hljs-keyword">FROM</span> Products
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> prod_name;</code></pre></div>


<p>注意：在指定一条<code>ORDER BY</code>子句时，应该保证它是SELECT语句中最后一条子句。</p>
<h2 id="3-2-按多个列排序"><a href="#3-2-按多个列排序" class="headerlink" title="3.2 按多个列排序"></a>3.2 按多个列排序</h2><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> prod_id, prod_price, prod_name
<span class="hljs-keyword">FROM</span> Products
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> prod_price, prod_name;</code></pre></div>

<h2 id="3-3-按列位置排序"><a href="#3-3-按列位置排序" class="headerlink" title="3.3 按列位置排序"></a>3.3 按列位置排序</h2><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> prod_id, prod_price, prod_name
<span class="hljs-keyword">FROM</span> Products
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-number">2</span>, <span class="hljs-number">3</span>;</code></pre></div>

<h2 id="3-4-指定排序方向"><a href="#3-4-指定排序方向" class="headerlink" title="3.4 指定排序方向"></a>3.4 指定排序方向</h2><p>为了进行降序排序，必须指定<code>DESC</code>关键字。</p>
<div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> prod_id, prod_price, prod_name
<span class="hljs-keyword">FROM</span> Products
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> prod_price <span class="hljs-keyword">DESC</span>;</code></pre></div>

<p>DESC关键字只应用到直接位于其前面的列名，<strong>如果想在多个列上进行降序排序，必须对每一列指定<code>DESC</code>关键字</strong>。</p>
<h1 id="四、过滤数据"><a href="#四、过滤数据" class="headerlink" title="四、过滤数据"></a>四、过滤数据</h1><h2 id="4-1-使用WHERE子句"><a href="#4-1-使用WHERE子句" class="headerlink" title="4.1  使用WHERE子句"></a>4.1  使用WHERE子句</h2><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> prod_name, prod_price
<span class="hljs-keyword">FROM</span> Products
<span class="hljs-keyword">WHERE</span> prod_price = <span class="hljs-number">3.49</span>;</code></pre></div>


<p>提示：在同时使用<code>ORDER BY</code>和<code>WHERE子</code>句时，应该让<code>ORDER BY</code>位于<code>WHERE</code>之后。</p>
<h2 id="4-2-WHERE子句操作符"><a href="#4-2-WHERE子句操作符" class="headerlink" title="4.2 WHERE子句操作符"></a>4.2 WHERE子句操作符</h2><h3 id="4-2-1-检查单个值"><a href="#4-2-1-检查单个值" class="headerlink" title="4.2.1 检查单个值"></a>4.2.1 检查单个值</h3><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> prod_name, prod_price
<span class="hljs-keyword">FROM</span> Products
<span class="hljs-keyword">WHERE</span> prod_price &lt; <span class="hljs-number">10</span>;</code></pre></div>

<h3 id="4-2-2-不匹配检查"><a href="#4-2-2-不匹配检查" class="headerlink" title="4.2.2 不匹配检查"></a>4.2.2 不匹配检查</h3><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> vend_id, prod_name
<span class="hljs-keyword">FROM</span> Products
<span class="hljs-keyword">WHERE</span> vend_id != <span class="hljs-string">'DLL01'</span>;</code></pre></div>

<h3 id="4-2-3-范围值检查"><a href="#4-2-3-范围值检查" class="headerlink" title="4.2.3 范围值检查"></a>4.2.3 范围值检查</h3><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> prod_name, prod_price
<span class="hljs-keyword">FROM</span> Products
<span class="hljs-keyword">WHERE</span> prod_price <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">5</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">10</span>;</code></pre></div>

<h3 id="4-2-4-空值检查"><a href="#4-2-4-空值检查" class="headerlink" title="4.2.4 空值检查"></a>4.2.4 空值检查</h3><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> prod_name
<span class="hljs-keyword">FROM</span> Products
<span class="hljs-keyword">WHERE</span> prod_price <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>;</code></pre></div>

<h1 id="五、高级数据过滤"><a href="#五、高级数据过滤" class="headerlink" title="五、高级数据过滤"></a>五、高级数据过滤</h1><h2 id="5-1-组合WHERE子句"><a href="#5-1-组合WHERE子句" class="headerlink" title="5.1 组合WHERE子句"></a>5.1 组合WHERE子句</h2><h3 id="5-1-1-AND操作符"><a href="#5-1-1-AND操作符" class="headerlink" title="5.1.1 AND操作符"></a>5.1.1 AND操作符</h3><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> prod_id, prod_price, prod_name
<span class="hljs-keyword">FROM</span> Products
<span class="hljs-keyword">WHERE</span> vend_id = <span class="hljs-string">'DLL01'</span> 
<span class="hljs-keyword">AND</span> prod_price &lt;= <span class="hljs-number">4</span>;</code></pre></div>

<h3 id="5-1-2-OR操作符"><a href="#5-1-2-OR操作符" class="headerlink" title="5.1.2 OR操作符"></a>5.1.2 OR操作符</h3><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> prod_name, prod_price
<span class="hljs-keyword">FROM</span> Products
<span class="hljs-keyword">WHERE</span> vend_id = <span class="hljs-string">'DLL01'</span> 
<span class="hljs-keyword">OR</span> vend_id = ‘BRS01’;</code></pre></div>

<h3 id="5-1-3-求值顺序"><a href="#5-1-3-求值顺序" class="headerlink" title="5.1.3 求值顺序"></a>5.1.3 求值顺序</h3><p><code>SQL</code>（像多数语言一样）在处理<code>OR</code>操作符前，<strong>优先处理<code>AND</code>操作符</strong>。可以使用<strong>圆括号</strong>对操作符进行明确分组。</p>
<div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> prod_name, prod_price
<span class="hljs-keyword">FROM</span> Products
<span class="hljs-keyword">WHERE</span> (vend_id = <span class="hljs-string">'DLL01'</span> <span class="hljs-keyword">OR</span> vend_id = ‘BRS01’)
<span class="hljs-keyword">AND</span> prod_price &gt;= <span class="hljs-number">10</span>;</code></pre></div>

<h2 id="5-2-IN操作符"><a href="#5-2-IN操作符" class="headerlink" title="5.2 IN操作符"></a>5.2 IN操作符</h2><p><code>IN</code>操作符用来<strong>指定条件范围</strong>，范围中的每个条件都可以进行匹配。</p>
<div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> prod_name, prod_price
<span class="hljs-keyword">FROM</span> Products
<span class="hljs-keyword">WHERE</span> vend_id <span class="hljs-keyword">IN</span> ( <span class="hljs-string">'DLL01'</span>, <span class="hljs-string">'BRS01'</span> )
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> prod_name;</code></pre></div>

<p>检索由供应商DLL01和BRS01制造的所有产品。等同于<code>OR</code>操作符。</p>
<h2 id="5-3-NOT操作符"><a href="#5-3-NOT操作符" class="headerlink" title="5.3 NOT操作符"></a>5.3 NOT操作符</h2><p>用来否定其后条件的关键字。</p>
<div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> prod_name
<span class="hljs-keyword">FROM</span> Products
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">NOT</span> vend_id = <span class="hljs-string">'DLL01'</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> prod_name;</code></pre></div>

<h1 id="六、用通配符进行过滤"><a href="#六、用通配符进行过滤" class="headerlink" title="六、用通配符进行过滤"></a>六、用通配符进行过滤</h1><h2 id="6-1-LIKE操作符"><a href="#6-1-LIKE操作符" class="headerlink" title="6.1 LIKE操作符"></a>6.1 LIKE操作符</h2><p>解决之前过滤方法无法解决的问题，</p>
<h3 id="6-1-1-百分号-通配符"><a href="#6-1-1-百分号-通配符" class="headerlink" title="6.1.1 百分号%通配符"></a>6.1.1 百分号%通配符</h3><p><code>%</code>表示任何字符出现任意次数。</p>
<p>如：我们希望从 “Persons” 表中选取居住在包含 “lon” 的城市里的人：</p>
<div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> Persons
<span class="hljs-keyword">WHERE</span> City <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'%lon%'</span></code></pre></div>

<p>再如：我们希望从 “Persons” 表中选取居住在以 “g” 结尾的城市里的人：</p>
<div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> Persons
<span class="hljs-keyword">WHERE</span> City <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'%g'</span></code></pre></div>

<h3 id="6-1-2-下划线-通配符"><a href="#6-1-2-下划线-通配符" class="headerlink" title="6.1.2 下划线_通配符"></a>6.1.2 下划线_通配符</h3><p>下划线的用途与<code>%</code>一样，但它只匹配单个字符，而不是多个字符。</p>
<h3 id="6-1-3-方括号-通配符"><a href="#6-1-3-方括号-通配符" class="headerlink" title="6.1.3 方括号[ ]通配符"></a>6.1.3 方括号[ ]通配符</h3><p>方括号<code>[]</code>通配符用来指定一个<strong>字符集</strong>，它必须匹配指定位置（通配符的位置）的<strong>一个字符</strong>。</p>
<div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> cust_contactFROM Customers
<span class="hljs-keyword">WHERE</span> cust_contact <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'[JM]%'</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> cust_contact;</code></pre></div>

<p>此通配符可以用前缀字符<code>^</code>（脱字号）来否定</p>
<h2 id="6-2-使用通配符的技巧"><a href="#6-2-使用通配符的技巧" class="headerlink" title="6.2 使用通配符的技巧"></a>6.2 使用通配符的技巧</h2><ul>
<li>不要过度使用通配符。如果其他操作符能达到相同的目的，应该使用其他操作符。</li>
<li>在确实需要使用通配符时，也尽量不要把它们用在搜索模式的开始处。把通配符置于开始处，搜索起来是最慢的。</li>
<li>仔细注意通配符的位置。如果放错地方，可能不会返回想要的数据。</li>
</ul>
<h1 id="七、创建计算字段"><a href="#七、创建计算字段" class="headerlink" title="七、创建计算字段"></a>七、创建计算字段</h1><h2 id="7-1-计算字段"><a href="#7-1-计算字段" class="headerlink" title="7.1 计算字段"></a>7.1 计算字段</h2><p>计算字段并不实际存在于数据库表中。计算字段是运行时在<code>SELECT</code>语句内创建的。</p>
<h2 id="7-2-拼接字段"><a href="#7-2-拼接字段" class="headerlink" title="7.2 拼接字段"></a>7.2 拼接字段</h2><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> vend_name + <span class="hljs-string">'('</span> + vend_country + <span class="hljs-string">')'</span>
<span class="hljs-keyword">FROM</span> Vendors
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> vend_name;</code></pre></div>

<p>去掉空格，使用SQL的<code>RTRIM()</code>函数来完成。</p>
<div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">RTRIM</span>(vend_name) + <span class="hljs-string">' ('</span> + <span class="hljs-keyword">RTRIM</span>(vend_country) + <span class="hljs-string">')'</span>
<span class="hljs-keyword">FROM</span> Vendors
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> vend_name;</code></pre></div>

<p>大多数DBMS都支持<code>RTRIM()</code>（正如刚才所见，它去掉字符串右边的空格）、<code>LTRIM()</code>（去掉字符串左边的空格）以及<code>TRIM()</code>（去掉字符串左右两边的空格）。</p>
<p>别名用<code>AS</code>关键字赋予</p>
<div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">RTRIM</span>(vend_name) + <span class="hljs-string">' ('</span> + <span class="hljs-keyword">RTRIM</span>(vend_country) + <span class="hljs-string">')'</span>
<span class="hljs-keyword">AS</span> vend_title
<span class="hljs-keyword">FROM</span> Vendors
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> vend_name;</code></pre></div>

<h2 id="7-3-执行算术计算"><a href="#7-3-执行算术计算" class="headerlink" title="7.3 执行算术计算"></a>7.3 执行算术计算</h2><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> prod_id,
quantity,
item_price,
quantity*item_price <span class="hljs-keyword">AS</span> expanded_price
<span class="hljs-keyword">FROM</span> OrderItems
<span class="hljs-keyword">WHERE</span> order_num = <span class="hljs-number">20008</span>;</code></pre></div>

<h1 id="八、使用数据处理函数"><a href="#八、使用数据处理函数" class="headerlink" title="八、使用数据处理函数"></a>八、使用数据处理函数</h1><h2 id="8-1-函数"><a href="#8-1-函数" class="headerlink" title="8.1 函数"></a>8.1 函数</h2><p>SQL函数不是可移植的。这表示为特定SQL实现编写的代码在其他实现中可能不正常。</p>
<h2 id="8-2-使用函数"><a href="#8-2-使用函数" class="headerlink" title="8.2 使用函数"></a>8.2 使用函数</h2><h3 id="8-2-1-文本处理函数"><a href="#8-2-1-文本处理函数" class="headerlink" title="8.2.1 文本处理函数"></a>8.2.1 文本处理函数</h3><p><code>UPPER()</code>将文本转换为大写</p>
<div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> vend_name, <span class="hljs-keyword">UPPER</span>(vend_name) <span class="hljs-keyword">AS</span> vend_name_upcase
<span class="hljs-keyword">FROM</span> Vendors
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> vend_name;</code></pre></div>

<p><img src="https://gitee.com/yang_yu_jie/blog-img/raw/master/img/20210530154929.png" srcset="/img/loading.gif" alt="image-20210530154929203"></p>
<p>使用<code>SOUNDEX()</code>函数进行搜索，它匹配所有发音类似的词。</p>
<div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> cust_name, cust_contact
<span class="hljs-keyword">FROM</span> Customers
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">SOUNDEX</span>(cust_contact) = <span class="hljs-keyword">SOUNDEX</span>(<span class="hljs-string">'Michael Green'</span>);</code></pre></div>

<h3 id="8-2-2-日期和时间处理函数"><a href="#8-2-2-日期和时间处理函数" class="headerlink" title="8.2.2 日期和时间处理函数"></a>8.2.2 日期和时间处理函数</h3><p><code>MySQL</code>用户可使用名为<code>YEAR()</code>的函数从日期中提取年份：</p>
<div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> order_num
<span class="hljs-keyword">FROM</span> Orders
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">YEAR</span>(order_date) = <span class="hljs-number">2012</span>;</code></pre></div>

<h3 id="8-2-3-数值处理函数"><a href="#8-2-3-数值处理函数" class="headerlink" title="8.2.3 数值处理函数"></a>8.2.3 数值处理函数</h3><p><img src="https://gitee.com/yang_yu_jie/blog-img/raw/master/img/20210530154906.png" srcset="/img/loading.gif" alt="image-20210530154906313"></p>
<h1 id="九、汇总数据"><a href="#九、汇总数据" class="headerlink" title="九、汇总数据"></a>九、汇总数据</h1><h2 id="9-1-聚集函数"><a href="#9-1-聚集函数" class="headerlink" title="9.1 聚集函数"></a>9.1 聚集函数</h2><p><img src="https://gitee.com/yang_yu_jie/blog-img/raw/master/img/20210530155025.png" srcset="/img/loading.gif" alt="image-20210530155025376"></p>
<div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">AVG</span>(prod_price) <span class="hljs-keyword">AS</span> avg_price
<span class="hljs-keyword">FROM</span> Products;</code></pre></div>

<p>说明：<strong>这些函数都忽略列值为<code>NULL</code>的行。</strong></p>
<p>使用<code>COUNT(*)</code>对表中行的数目进行计数，不管表列中包含的是空值（NULL）还是非空值。</p>
<p>使用<code>COUNT(column)</code>对特定列中具有值的行进行计数，忽略NULL值</p>
<h2 id="9-2-聚集不同值"><a href="#9-2-聚集不同值" class="headerlink" title="9.2 聚集不同值"></a>9.2 聚集不同值</h2><p>使用<code>AVG()</code>函数返回特定供应商提供的产品的平均价格，但使用了<code>DISTINCT</code>参数，因此平均值只考虑各个不同的价格。</p>
<div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">AVG</span>(<span class="hljs-keyword">DISTINCT</span> prod_price) <span class="hljs-keyword">AS</span> avg_price
<span class="hljs-keyword">FROM</span> Products
<span class="hljs-keyword">WHERE</span> vend_id = <span class="hljs-string">'DLL01'</span>;</code></pre></div>

<h2 id="9-3-组合聚集函数"><a href="#9-3-组合聚集函数" class="headerlink" title="9.3 组合聚集函数"></a>9.3 组合聚集函数</h2><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">AS</span> num_items,
<span class="hljs-keyword">MIN</span>(prod_price) <span class="hljs-keyword">AS</span> price_min,
<span class="hljs-keyword">MAX</span>(prod_price) <span class="hljs-keyword">AS</span> price_max,
<span class="hljs-keyword">AVG</span>(prod_price) <span class="hljs-keyword">AS</span> price_avg
<span class="hljs-keyword">FROM</span> Products;</code></pre></div>

<h1 id="十、分组数据"><a href="#十、分组数据" class="headerlink" title="十、分组数据"></a>十、分组数据</h1><h2 id="10-1-数据分组"><a href="#10-1-数据分组" class="headerlink" title="10.1 数据分组"></a>10.1 数据分组</h2><p>使用分组可以将数据分为多个逻辑组，对每个组进行聚集计算。</p>
<h2 id="10-2-创建分组"><a href="#10-2-创建分组" class="headerlink" title="10.2 创建分组"></a>10.2 创建分组</h2><p><code>GROUP BY</code>子句指示<code>DBMS</code>分组数据，然后对每个组而不是整个结果集进行聚集。</p>
<div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> vend_id, <span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">AS</span> num_prods
<span class="hljs-keyword">FROM</span> Products
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> vend_id;</code></pre></div>

<p><code>GROUP BY</code>子句必须出现在<code>WHERE</code>子句之后，<code>ORDER BY</code>子句之前。</p>
<h2 id="10-3-过滤分组"><a href="#10-3-过滤分组" class="headerlink" title="10.3 过滤分组"></a>10.3 过滤分组</h2><p><code>WHERE</code>过滤行，而<code>HAVING</code>过滤分组。</p>
<p>提示：<code>HAVING</code>支持所有<code>WHERE</code>操作符</p>
<div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> cust_id, <span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">AS</span> orders
<span class="hljs-keyword">FROM</span> Orders
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> cust_id
<span class="hljs-keyword">HAVING</span> <span class="hljs-keyword">COUNT</span>(*) &gt;= <span class="hljs-number">2</span>;</code></pre></div>

<p><code>WHERE</code>在数据分组前进行过滤，<code>HAVING</code>在数据分组后进行过滤。</p>
<h2 id="10-4-分组和排序"><a href="#10-4-分组和排序" class="headerlink" title="10.4 分组和排序"></a>10.4 分组和排序</h2><p><img src="https://gitee.com/yang_yu_jie/blog-img/raw/master/img/20210530155211.png" srcset="/img/loading.gif" alt="image-20210530155211680"></p>
<h2 id="10-5-SELECT子句顺序"><a href="#10-5-SELECT子句顺序" class="headerlink" title="10.5 SELECT子句顺序"></a>10.5 SELECT子句顺序</h2><p>表10-2 SELECT子句及其顺序</p>
<p><img src="https://gitee.com/yang_yu_jie/blog-img/raw/master/img/20210530155228.png" srcset="/img/loading.gif" alt="image-20210530155228648"></p>
<h1 id="十一、使用子查询"><a href="#十一、使用子查询" class="headerlink" title="十一、使用子查询"></a>十一、使用子查询</h1><h2 id="11-1-利用子查询进行过滤"><a href="#11-1-利用子查询进行过滤" class="headerlink" title="11.1 利用子查询进行过滤"></a>11.1 利用子查询进行过滤</h2><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> cust_id
<span class="hljs-keyword">FROM</span> Orders
<span class="hljs-keyword">WHERE</span> order_num <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> order_num
<span class="hljs-keyword">FROM</span> OrderItems
<span class="hljs-keyword">WHERE</span> prod_id = <span class="hljs-string">'RGAN01'</span>);</code></pre></div>


<p>作为子查询的<code>SELECT</code>语句只能查询单个列。</p>
<h2 id="11-2-作为计算字段使用子查询"><a href="#11-2-作为计算字段使用子查询" class="headerlink" title="11.2 作为计算字段使用子查询"></a>11.2 作为计算字段使用子查询</h2><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> cust_name,
cust_state,
(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(*)
<span class="hljs-keyword">FROM</span> Orders
<span class="hljs-keyword">WHERE</span> Orders.cust_id = Customers.cust_id) <span class="hljs-keyword">AS</span> orders
<span class="hljs-keyword">FROM</span> Customers
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> cust_name;</code></pre></div>

<h1 id="十二、联结表"><a href="#十二、联结表" class="headerlink" title="十二、联结表"></a>十二、联结表</h1><h2 id="12-1-联结"><a href="#12-1-联结" class="headerlink" title="12.1 联结"></a>12.1 联结</h2><h3 id="12-1-1-关系表"><a href="#12-1-1-关系表" class="headerlink" title="12.1.1 关系表"></a>12.1.1 关系表</h3><p>关系表的设计就是要把信息分解成多个表，一类数据一个表。各表通过某些共同的值互相关联（所以才叫关系数据库）。</p>
<h3 id="12-1-2-为什么使用联结"><a href="#12-1-2-为什么使用联结" class="headerlink" title="12.1.2 为什么使用联结"></a>12.1.2 为什么使用联结</h3><p>联结是一种机制，用来在一条<code>SELECT</code>语句中关联表，因此称为联结。使用特殊的语法，可以联结多个表返回一组输出，联结在运行时关联表中正确的行。</p>
<h2 id="12-2-创建联结"><a href="#12-2-创建联结" class="headerlink" title="12.2 创建联结"></a>12.2 创建联结</h2><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> vend_name, prod_name, prod_price
<span class="hljs-keyword">FROM</span> Vendors, Products
<span class="hljs-keyword">WHERE</span> Vendors.vend_id = Products.vend_id;</code></pre></div>

<h3 id="12-2-1-WHERE子句的重要性"><a href="#12-2-1-WHERE子句的重要性" class="headerlink" title="12.2.1 WHERE子句的重要性"></a>12.2.1 WHERE子句的重要性</h3><p>没有<code>WHERE</code>子句，第一个表中的每一行将与第二个表中的每一行配对，而不管它们逻辑上是否能配在一起。</p>
<h3 id="12-2-2-内联结"><a href="#12-2-2-内联结" class="headerlink" title="12.2.2 内联结"></a>12.2.2 内联结</h3><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> vend_name, prod_name, prod_price
<span class="hljs-keyword">FROM</span> Vendors <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> Products
<span class="hljs-keyword">ON</span> Vendors.vend_id = Products.vend_id;</code></pre></div>

<h3 id="12-2-3-联结多个表"><a href="#12-2-3-联结多个表" class="headerlink" title="12.2.3 联结多个表"></a>12.2.3 联结多个表</h3><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> prod_name, vend_name, prod_price, quantity
<span class="hljs-keyword">FROM</span> OrderItems, Products, Vendors
<span class="hljs-keyword">WHERE</span> Products.vend_id = Vendors.vend_id
<span class="hljs-keyword">AND</span> OrderItems.prod_id = Products.prod_id
<span class="hljs-keyword">AND</span> order_num = <span class="hljs-number">20007</span>;</code></pre></div>

<h1 id="十三、创建高级联结"><a href="#十三、创建高级联结" class="headerlink" title="十三、创建高级联结"></a>十三、创建高级联结</h1><h2 id="13-1-使用表别名"><a href="#13-1-使用表别名" class="headerlink" title="13.1 使用表别名"></a>13.1 使用表别名</h2><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">RTRIM</span>(vend_name) + <span class="hljs-string">' ('</span> + <span class="hljs-keyword">RTRIM</span>(vend_country) + <span class="hljs-string">')'</span>
<span class="hljs-keyword">AS</span> vend_title
<span class="hljs-keyword">FROM</span> Vendors
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> vend_name;</code></pre></div>

<h2 id="13-2-使用不同类型的联结"><a href="#13-2-使用不同类型的联结" class="headerlink" title="13.2 使用不同类型的联结"></a>13.2 使用不同类型的联结</h2><h3 id="13-2-1-自联结"><a href="#13-2-1-自联结" class="headerlink" title="13.2.1 自联结"></a>13.2.1 自联结</h3><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> c1.cust_id, c1.cust_name, c1.cust_contact
<span class="hljs-keyword">FROM</span> Customers <span class="hljs-keyword">AS</span> c1, Customers <span class="hljs-keyword">AS</span> c2
<span class="hljs-keyword">WHERE</span> c1.cust_name = c2.cust_name
<span class="hljs-keyword">AND</span> c2.cust_contact = <span class="hljs-string">'Jim Jones'</span>;</code></pre></div>

<h3 id="13-2-2-自然联结"><a href="#13-2-2-自然联结" class="headerlink" title="13.2.2 自然联结"></a>13.2.2 自然联结</h3><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> C.*, O.order_num, O.order_date,
OI.prod_id, OI.quantity, OI.item_price
<span class="hljs-keyword">FROM</span> Customers <span class="hljs-keyword">AS</span> C, Orders <span class="hljs-keyword">AS</span> O, OrderItems <span class="hljs-keyword">AS</span> OI
<span class="hljs-keyword">WHERE</span> C.cust_id = O.cust_id
<span class="hljs-keyword">AND</span> OI.order_num = O.order_num
<span class="hljs-keyword">AND</span> prod_id = <span class="hljs-string">'RGAN01'</span>;</code></pre></div>

<h3 id="13-2-3-外联结"><a href="#13-2-3-外联结" class="headerlink" title="13.2.3 外联结"></a>13.2.3 外联结</h3><p><strong>联结包含了那些在相关表中没有关联行的行。</strong>这种联结称为外联结。</p>
<div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> Customers.cust_id, Orders.order_num
<span class="hljs-keyword">FROM</span> Customers <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> Orders
<span class="hljs-keyword">ON</span> Customers.cust_id = Orders.cust_id;</code></pre></div>

<p>在使用<code>OUTER JOIN</code>语法时，必须使用<code>RIGHT</code>或<code>LEFT</code>关键字指定包括其所有行的表（<code>RIGHT</code>指出的是<code>OUTER JOIN</code>右边的表，而<code>LEFT</code>指出的是<code>OUTER JOIN</code>左边的表）。</p>
<p>左外联接的结果集包括<code>LEFT OUTER</code>子句中指定的左表的所有行，而不仅仅是联接列所匹配的行。如果左表的某行在右表中没有匹配行，则在相关联的结果集行中右表的所有选择列表列均为空值。</p>
<p>全外联结（<code>full outer join</code>），它检索两个表中的所有行并关联那些可以关联的行。（<strong>MySQl不支持</strong>）</p>
<h3 id="13-3-使用带聚集函数的联结"><a href="#13-3-使用带聚集函数的联结" class="headerlink" title="13.3 使用带聚集函数的联结"></a>13.3 使用带聚集函数的联结</h3><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> Customers.cust_id,
<span class="hljs-keyword">COUNT</span>(Orders.order_num) <span class="hljs-keyword">AS</span> num_ord
<span class="hljs-keyword">FROM</span> Customers <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> Orders
<span class="hljs-keyword">ON</span> Customers.cust_id = Orders.cust_id
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> Customers.cust_id;</code></pre></div>

<h2 id="13-4-使用联结和联结条件"><a href="#13-4-使用联结和联结条件" class="headerlink" title="13.4 使用联结和联结条件"></a>13.4 使用联结和联结条件</h2><p>在总结讨论联结的这两课前，有必要汇总一下联结及其使用的要点。<br>    • 注意所使用的联结类型。一般我们使用内联结，但使用外联结也有效。<br>    • 关于确切的联结语法，应该查看具体的文档，看相应的DBMS支持何种语法（大多数DBMS使用这两课中描述的某种语法）。<br>    • 保证使用正确的联结条件（不管采用哪种语法），否则会返回不正确的数据。<br>    • 应该总是提供联结条件，否则会得出笛卡儿积。<br>    • 在一个联结中可以包含多个表，甚至可以对每个联结采用不同的联结类型。虽然这样做是合法的，一般也很有用，但应该在一起测试它们前分别测试每个联结。这会使故障排除更为简单。</p>
<h1 id="十四、-组合查询"><a href="#十四、-组合查询" class="headerlink" title="十四、 组合查询"></a>十四、 组合查询</h1><h2 id="14-1-组合查询"><a href="#14-1-组合查询" class="headerlink" title="14.1 组合查询"></a>14.1 组合查询</h2><p>主要有两种情况需要使用组合查询：<br>    1. 在一个查询中从不同的表返回结构数据；<br>    2. 对一个表执行多个查询，按一个查询返回数据。</p>
<h2 id="14-2-创建组合查询"><a href="#14-2-创建组合查询" class="headerlink" title="14.2 创建组合查询"></a>14.2 创建组合查询</h2><p>可用<code>UNION</code>操作符来组合数条<code>SQL</code>查询。</p>
<h3 id="14-2-1-使用UNION"><a href="#14-2-1-使用UNION" class="headerlink" title="14.2.1 使用UNION"></a>14.2.1 使用UNION</h3><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> cust_name, cust_contact, cust_email
<span class="hljs-keyword">FROM</span> Customers
<span class="hljs-keyword">WHERE</span> cust_state <span class="hljs-keyword">IN</span> (<span class="hljs-string">'IL'</span>,<span class="hljs-string">'IN'</span>,<span class="hljs-string">'MI'</span>)
<span class="hljs-keyword">UNION</span>
<span class="hljs-keyword">SELECT</span> cust_name, cust_contact, cust_email
<span class="hljs-keyword">FROM</span> Customers
<span class="hljs-keyword">WHERE</span> cust_name = <span class="hljs-string">'Fun4All'</span>;</code></pre></div>

<h3 id="14-2-2-UNION规则"><a href="#14-2-2-UNION规则" class="headerlink" title="14.2.2 UNION规则"></a>14.2.2 UNION规则</h3><ul>
<li><code>UNION</code>必须由两条或两条以上的<code>SELECT</code>语句组成，语句之间用关键字<code>UNION</code>分隔（因此，如果组合四条<code>SELECT</code>语句，将要使用三个<code>UNION</code>关键字）。</li>
<li><code>UNION</code>中的每个查询必须包含相同的列、表达式或聚集函数（不过，各个列不需要以相同的次序列出）。</li>
<li>列数据类型必须兼容：类型不必完全相同，但必须是DBMS可以隐含转换的类型（例如，不同的数值类型或不同的日期类型）。</li>
</ul>
<h3 id="14-2-3-包含或取消重复的行"><a href="#14-2-3-包含或取消重复的行" class="headerlink" title="14.2.3 包含或取消重复的行"></a>14.2.3 包含或取消重复的行</h3><p>如果想返回所有的匹配行，可使用<code>UNION ALL</code>而不是UNION。</p>
<h3 id="14-2-4-对组合查询结果排序"><a href="#14-2-4-对组合查询结果排序" class="headerlink" title="14.2.4 对组合查询结果排序"></a>14.2.4 对组合查询结果排序</h3><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> cust_name, cust_contact, cust_email
<span class="hljs-keyword">FROM</span> Customers
<span class="hljs-keyword">WHERE</span> cust_state <span class="hljs-keyword">IN</span> (<span class="hljs-string">'IL'</span>,<span class="hljs-string">'IN'</span>,<span class="hljs-string">'MI'</span>)
<span class="hljs-keyword">UNION</span>
<span class="hljs-keyword">SELECT</span> cust_name, cust_contact, cust_email
<span class="hljs-keyword">FROM</span> Customers
<span class="hljs-keyword">WHERE</span> cust_name = <span class="hljs-string">'Fun4All'</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> cust_name, cust_contact;</code></pre></div>


<p>实际上DBMS将用它来排序所有SELECT语句返回的所有结果 </p>
<h1 id="十五、插入数据"><a href="#十五、插入数据" class="headerlink" title="十五、插入数据"></a>十五、插入数据</h1><h2 id="15-1-数据插入"><a href="#15-1-数据插入" class="headerlink" title="15.1 数据插入"></a>15.1 数据插入</h2><p>使用<code>INSERT</code>语句可能需要客户端/服务器DBMS中的特定安全权限。在你试图使用<code>INSERT</code>前，应该保证自己有足够的安全权限。</p>
<h3 id="15-1-1-插入完整的行"><a href="#15-1-1-插入完整的行" class="headerlink" title="15.1.1 插入完整的行"></a>15.1.1 插入完整的行</h3><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> Customers(cust_id,
	cust_name,
	cust_address,
	cust_city,
	cust_state,
	cust_zip,
	cust_country,
	cust_contact,
	cust_email)
<span class="hljs-keyword">VALUES</span>(<span class="hljs-string">'1000000006'</span>,
	<span class="hljs-string">'Toy Land'</span>,
	<span class="hljs-string">'123 Any Street'</span>,
	<span class="hljs-string">'New York'</span>,
	<span class="hljs-string">'NY'</span>,
	<span class="hljs-string">'11111'</span>,
	<span class="hljs-string">'USA'</span>,
	<span class="hljs-literal">NULL</span>,
	<span class="hljs-literal">NULL</span>);</code></pre></div>

<h3 id="15-1-2-插入部分行"><a href="#15-1-2-插入部分行" class="headerlink" title="15.1.2 插入部分行"></a>15.1.2 插入部分行</h3><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> Customers(cust_id,
	cust_name,
	cust_address,
	cust_city,
	cust_state,
	cust_zip,
	cust_country)
<span class="hljs-keyword">VALUES</span>(<span class="hljs-string">'1000000006'</span>,
	<span class="hljs-string">'Toy Land'</span>,
	<span class="hljs-string">'123 Any Street'</span>,
	<span class="hljs-string">'New York'</span>,
	<span class="hljs-string">'NY'</span>,
	<span class="hljs-string">'11111'</span>,
	<span class="hljs-string">'USA'</span>);</code></pre></div>

<h3 id="15-1-3-插入检索出的数据"><a href="#15-1-3-插入检索出的数据" class="headerlink" title="15.1.3 插入检索出的数据"></a>15.1.3 插入检索出的数据</h3><p>利用它将<code>SELECT</code>语句的结果插入表中，这就是所谓的<code>INSERT SELECT</code>。</p>
<div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> Customers(cust_id,
	cust_contact,
	cust_email,
	cust_name,
	cust_address,
	cust_city,
	cust_state,
	cust_zip,
	cust_country)
<span class="hljs-keyword">SELECT</span> cust_id,
	cust_contact,
	cust_email,
	cust_name,
	cust_address,
	cust_city,
	cust_state,
	cust_zip,
	cust_country
<span class="hljs-keyword">FROM</span> CustNew;</code></pre></div>

<h2 id="15-2-从一个表复制到另一个表"><a href="#15-2-从一个表复制到另一个表" class="headerlink" title="15.2 从一个表复制到另一个表"></a>15.2 从一个表复制到另一个表</h2><p>要将一个表的内容复制到一个全新的表（运行中创建的表），可以使用<code>SELECT INTO</code>语句。</p>
<div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> *
<span class="hljs-keyword">INTO</span> CustCopy
<span class="hljs-keyword">FROM</span> Customers;</code></pre></div>

<h1 id="十六、更新和删除数据"><a href="#十六、更新和删除数据" class="headerlink" title="十六、更新和删除数据"></a>十六、更新和删除数据</h1><h2 id="16-1-更新数据"><a href="#16-1-更新数据" class="headerlink" title="16.1 更新数据"></a>16.1 更新数据</h2><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">UPDATE</span> Customers
<span class="hljs-keyword">SET</span> cust_email = <span class="hljs-string">'kim@thetoystore.com'</span>
<span class="hljs-keyword">WHERE</span> cust_id = <span class="hljs-string">'1000000005'</span>;</code></pre></div>


<p>更新多列：</p>
<div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">UPDATE</span> Customers
<span class="hljs-keyword">SET</span> cust_contact = <span class="hljs-string">'Sam Roberts'</span>,
	cust_email = <span class="hljs-string">'sam@toyland.com'</span>
<span class="hljs-keyword">WHERE</span> cust_id = <span class="hljs-string">'1000000006'</span>;</code></pre></div>

<h2 id="16-2-删除数据"><a href="#16-2-删除数据" class="headerlink" title="16.2 删除数据"></a>16.2 删除数据</h2><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> Customers
<span class="hljs-keyword">WHERE</span> cust_id = <span class="hljs-string">'1000000006'</span>;</code></pre></div>

<p><code>DELETE</code>语句从表中删除行，甚至是删除表中所有行。但是，<strong>DELETE不删除表本身。</strong></p>
<h1 id="十七、创建和操纵表"><a href="#十七、创建和操纵表" class="headerlink" title="十七、创建和操纵表"></a>十七、创建和操纵表</h1><h2 id="17-1-创建表"><a href="#17-1-创建表" class="headerlink" title="17.1 创建表"></a>17.1 创建表</h2><h3 id="17-1-1-表创建基础"><a href="#17-1-1-表创建基础" class="headerlink" title="17.1.1 表创建基础"></a>17.1.1 表创建基础</h3><p>利用<code>CREATE TABLE</code>创建表，必须给出下列信息：<br>    • 新表的名字，在关键字<code>CREATE TABLE</code>之后给出；<br>    • 表列的名字和定义，用逗号分隔；<br>    • 有的DBMS还要求指定表的位置。</p>
<div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> Products
(
	prod_id <span class="hljs-built_in">CHAR</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
	vend_id <span class="hljs-built_in">CHAR</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
	prod_name <span class="hljs-built_in">CHAR</span>(<span class="hljs-number">254</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
	prod_price <span class="hljs-built_in">DECIMAL</span>(<span class="hljs-number">8</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
	prod_desc <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">1000</span>) <span class="hljs-literal">NULL</span>
);</code></pre></div>

<h3 id="17-1-2-使用NULL值"><a href="#17-1-2-使用NULL值" class="headerlink" title="17.1.2 使用NULL值"></a>17.1.2 使用NULL值</h3><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> Orders
(
	order_num <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
	order_date DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
	cust_id <span class="hljs-built_in">CHAR</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>
);</code></pre></div>


<p>只有不允许NULL值的列可作为主键，允许NULL值的列不能作为唯一标识。</p>
<h3 id="17-1-3-指定默认值"><a href="#17-1-3-指定默认值" class="headerlink" title="17.1.3 指定默认值"></a>17.1.3 指定默认值</h3><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> OrderItems
(
	order_num <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
	order_item <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
	prod_id <span class="hljs-built_in">CHAR</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
	quantity <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span>,
	item_price <span class="hljs-built_in">DECIMAL</span>(<span class="hljs-number">8</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>
);</code></pre></div>

<h2 id="17-2-更新表"><a href="#17-2-更新表" class="headerlink" title="17.2 更新表"></a>17.2 更新表</h2><p>更新表定义，可以使用<code>ALTER TABLE</code>语句。</p>
<div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> Vendors
<span class="hljs-keyword">ADD</span> vend_phone <span class="hljs-built_in">CHAR</span>(<span class="hljs-number">20</span>);</code></pre></div>

<h2 id="17-3-删除表"><a href="#17-3-删除表" class="headerlink" title="17.3 删除表"></a>17.3 删除表</h2><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> CustCopy;</code></pre></div>


<p>删除表没有确认，也不能撤销，执行这条语句将永久删除该表。</p>
<h2 id="17-4-重命名表"><a href="#17-4-重命名表" class="headerlink" title="17.4 重命名表"></a>17.4 重命名表</h2><p><code>RENAME</code></p>
<h1 id="十八、使用视图"><a href="#十八、使用视图" class="headerlink" title="十八、使用视图"></a>十八、使用视图</h1><h2 id="18-1-视图"><a href="#18-1-视图" class="headerlink" title="18.1 视图"></a>18.1 视图</h2><p>视图是虚拟的表。与包含数据的表不一样，视图只包含使用时动态检索数据的查询。</p>
<h3 id="18-1-1-为什么使用视图"><a href="#18-1-1-为什么使用视图" class="headerlink" title="18.1.1 为什么使用视图"></a>18.1.1 为什么使用视图</h3><p>视图的一些常见应用。<br>    • 重用SQL语句。<br>    • 简化复杂的SQL操作。在编写查询后，可以方便地重用它而不必知道其基本查询细节。<br>    • 使用表的一部分而不是整个表。<br>    • 保护数据。可以授予用户访问表的特定部分的权限，而不是整个表的访问权限。<br>    • 更改数据格式和表示。视图可返回与底层表的表示和格式不同的数据</p>
<h2 id="18-2-创建视图"><a href="#18-2-创建视图" class="headerlink" title="18.2 创建视图"></a>18.2 创建视图</h2><p>视图用<code>CREATE VIEW</code>语句来创建。<code>REATE VIEW</code>只能用于创建不存在的视图。</p>
<p>删除视图，可以使用<code>DROP</code>语句，其语法为</p>
<div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">VIEW</span> viewname</code></pre></div>

<h3 id="18-2-1-利用视图简化复杂的联结"><a href="#18-2-1-利用视图简化复杂的联结" class="headerlink" title="18.2.1 利用视图简化复杂的联结"></a>18.2.1 利用视图简化复杂的联结</h3><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> ProductCustomers <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> cust_name, cust_contact, prod_id
<span class="hljs-keyword">FROM</span> Customers, Orders, OrderItems
<span class="hljs-keyword">WHERE</span> Customers.cust_id = Orders.cust_id
<span class="hljs-keyword">AND</span> OrderItems.order_num = Orders.order_num;</code></pre></div>

<p>检索订购了产品RGAN01的顾客，可如下进行：</p>
<div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> cust_name, cust_contact
<span class="hljs-keyword">FROM</span> ProductCustomers
<span class="hljs-keyword">WHERE</span> prod_id = <span class="hljs-string">'RGAN01'</span>;</code></pre></div>

<h3 id="18-2-2-用视图重新格式化检索出的数据"><a href="#18-2-2-用视图重新格式化检索出的数据" class="headerlink" title="18.2.2 用视图重新格式化检索出的数据"></a>18.2.2 用视图重新格式化检索出的数据</h3><p>假设经常需要这个格式的结果。我们不必在每次需要时执行这种拼接，而是创建一个视图，使用它即可。</p>
<div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> VendorLocations <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">RTRIM</span>(vend_name) + <span class="hljs-string">' ('</span> + <span class="hljs-keyword">RTRIM</span>(vend_country) + <span class="hljs-string">')'</span>
<span class="hljs-keyword">AS</span> vend_title
<span class="hljs-keyword">FROM</span> Vendors;</code></pre></div>

<h3 id="18-2-3-用视图过滤不想要的数据"><a href="#18-2-3-用视图过滤不想要的数据" class="headerlink" title="18.2.3 用视图过滤不想要的数据"></a>18.2.3 用视图过滤不想要的数据</h3><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> CustomerEMailList <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> cust_id, cust_name, cust_email
<span class="hljs-keyword">FROM</span> Customers
<span class="hljs-keyword">WHERE</span> cust_email <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>;</code></pre></div>

<h3 id="18-2-4-使用视图与计算字段"><a href="#18-2-4-使用视图与计算字段" class="headerlink" title="18.2.4 使用视图与计算字段"></a>18.2.4 使用视图与计算字段</h3><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> OrderItemsExpanded <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> order_num,
	prod_id,
	quantity,
	item_price,
	quantity*item_price <span class="hljs-keyword">AS</span> expanded_price
<span class="hljs-keyword">FROM</span> OrderItems;</code></pre></div>

<h1 id="十九、使用存储过程"><a href="#十九、使用存储过程" class="headerlink" title="十九、使用存储过程"></a>十九、使用存储过程</h1><h2 id="19-1-存储过程"><a href="#19-1-存储过程" class="headerlink" title="19.1 存储过程"></a>19.1 存储过程</h2><p>存储过程就是为以后使用而保存的一条或多条SQL语句。</p>
<h2 id="19-2-为什么要使用存储过程"><a href="#19-2-为什么要使用存储过程" class="headerlink" title="19.2 为什么要使用存储过程"></a>19.2 为什么要使用存储过程</h2><ul>
<li>通过把处理封装在一个易用的单元中，可以简化复杂的操作（如前面例子所述）。</li>
<li>由于不要求反复建立一系列处理步骤，因而保证了数据的一致性。如果所有开发人员和应用程序都使用同一存储过程，则所使用的代码都是相同的。</li>
<li>这一点的延伸就是防止错误。需要执行的步骤越多，出错的可能性就越大。防止错误保证了数据的一致性。</li>
<li>简化对变动的管理。如果表名、列名或业务逻辑（或别的内容）有变化，那么只需要更改存储过程的代码。使用它的人员甚至不需要知道这些变化。</li>
<li>这一点的延伸就是安全性。通过存储过程限制对基础数据的访问，减少了数据讹误（无意识的或别的原因所导致的数据讹误）的机会。</li>
<li>因为存储过程通常以编译过的形式存储，所以DBMS处理命令的工作较少，提高了性能。</li>
<li>存在一些只能用在单个请求中的SQL元素和特性，存储过程可以使用它们来编写功能更强更灵活的代码。</li>
</ul>
<h2 id="19-3-执行存储过程"><a href="#19-3-执行存储过程" class="headerlink" title="19.3 执行存储过程"></a>19.3 执行存储过程</h2><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">EXECUTE</span> AddNewProduct( <span class="hljs-string">'JTS01'</span>,
	<span class="hljs-string">'Stuffed Eiffel Tower'</span>,
	<span class="hljs-number">6.49</span>,
	<span class="hljs-string">'Plush stuffed toy with the text LaTour Eiffel in red white and blue'</span> );</code></pre></div>

<p>分析▼<br>这里执行一个名为AddNewProduct的存储过程，将一个新产品添加到Products表中。AddNewProduct有四个参数，分别是：供应商<br>ID（Vendors表的主键）、产品名、价格和描述。这4个参数匹配存储过程中4个预期变量（定义为存储过程自身的组成部分）。此存储过程将新行添加到Products表，并将传入的属性赋给相应的列。</p>
<h2 id="19-4-创建存储过程"><a href="#19-4-创建存储过程" class="headerlink" title="19.4 创建存储过程"></a>19.4 创建存储过程</h2><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> MailingListCount (
	ListCount <span class="hljs-keyword">OUT</span> <span class="hljs-built_in">INTEGER</span>
) 
<span class="hljs-keyword">IS</span>
v_rows <span class="hljs-built_in">INTEGER</span>;
<span class="hljs-keyword">BEGIN</span>
	<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">INTO</span> v_rows
	<span class="hljs-keyword">FROM</span> Customers
	<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">NOT</span> cust_email <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>;
	ListCount := v_rows;
<span class="hljs-keyword">END</span>;</code></pre></div>

<h1 id="二十、管理事务处理"><a href="#二十、管理事务处理" class="headerlink" title="二十、管理事务处理"></a>二十、管理事务处理</h1><h2 id="20-1-事务处理"><a href="#20-1-事务处理" class="headerlink" title="20.1 事务处理"></a>20.1 事务处理</h2><p>确保成批的SQL操作要么完全执行，要么完全不执行，来维护数据库的完整性。<br>在使用事务处理时，有几个反复出现的关键词。下面是关于事务处理需要知道的几个术语：</p>
<ul>
<li>事务（transaction）指一组SQL语句；</li>
<li>回退（rollback）指撤销指定SQL语句的过程；</li>
<li>提交（commit）指将未存储的SQL语句结果写入数据库表；</li>
<li>保留点（savepoint）指事务处理中设置的临时占位符（placeholder），可以对它发布回退（与回退整个事务处理不同）</li>
</ul>
<h2 id="20-2-控制事务处理"><a href="#20-2-控制事务处理" class="headerlink" title="20.2 控制事务处理"></a>20.2 控制事务处理</h2><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">START</span> <span class="hljs-keyword">TRANSACTION</span></code></pre></div>

<h3 id="20-2-1-使用ROLLBACK"><a href="#20-2-1-使用ROLLBACK" class="headerlink" title="20.2.1 使用ROLLBACK"></a>20.2.1 使用ROLLBACK</h3><p>SQL的<strong>ROLLBACK</strong>命令用来回退（撤销）SQL语句</p>
<h3 id="20-2-2-使用COMMIT"><a href="#20-2-2-使用COMMIT" class="headerlink" title="20.2.2 使用COMMIT"></a>20.2.2 使用COMMIT</h3><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">BEGIN</span> <span class="hljs-keyword">TRANSACTION</span>
<span class="hljs-keyword">DELETE</span> OrderItems <span class="hljs-keyword">WHERE</span> order_num = <span class="hljs-number">12345</span>
<span class="hljs-keyword">DELETE</span> Orders <span class="hljs-keyword">WHERE</span> order_num = <span class="hljs-number">12345</span>
<span class="hljs-keyword">COMMIT</span> <span class="hljs-keyword">TRANSACTION</span></code></pre></div>

<h3 id="20-2-3-使用保留点"><a href="#20-2-3-使用保留点" class="headerlink" title="20.2.3 使用保留点"></a>20.2.3 使用保留点</h3><p>设置保留点：</p>
<div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SAVEPOINT</span> delete1;</code></pre></div>

<p>回滚到保留点：</p>
<div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">ROLLBACK</span> <span class="hljs-keyword">TO</span> delete1;</code></pre></div>

<p>完整示例：</p>
<div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">BEGIN</span> <span class="hljs-keyword">TRANSACTION</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> Customers(cust_id, cust_name)
<span class="hljs-keyword">VALUES</span>(<span class="hljs-string">'1000000010'</span>, <span class="hljs-string">'Toys Emporium'</span>);
SAVE TRANSACTION StartOrder;
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> Orders(order_num, order_date, cust_id)
<span class="hljs-keyword">VALUES</span>(<span class="hljs-number">20100</span>,<span class="hljs-string">'2001/12/1'</span>,<span class="hljs-string">'1000000010'</span>);
IF @@ERROR &lt;&gt; 0 ROLLBACK TRANSACTION StartOrder;
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> OrderItems(order_num, order_item, prod_id, quantity, item_price)
<span class="hljs-keyword">VALUES</span>(<span class="hljs-number">20100</span>, <span class="hljs-number">1</span>, <span class="hljs-string">'BR01'</span>, <span class="hljs-number">100</span>, <span class="hljs-number">5.49</span>);
IF @@ERROR &lt;&gt; 0 ROLLBACK TRANSACTION StartOrder;
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> OrderItems(order_num, order_item, prod_id, quantity, item_price)
<span class="hljs-keyword">VALUES</span>(<span class="hljs-number">20100</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'BR03'</span>, <span class="hljs-number">100</span>, <span class="hljs-number">10.99</span>);
IF @@ERROR &lt;&gt; 0 ROLLBACK TRANSACTION StartOrder;
<span class="hljs-keyword">COMMIT</span> <span class="hljs-keyword">TRANSACTION</span></code></pre></div>

<h1 id="二十一、使用游标"><a href="#二十一、使用游标" class="headerlink" title="二十一、使用游标"></a>二十一、使用游标</h1><h2 id="21-1-游标"><a href="#21-1-游标" class="headerlink" title="21.1 游标"></a>21.1 游标</h2><p>游标（cursor）是一个存储在DBMS服务器上的数据库查询，它不是一条SELECT语句，而是被该语句检索出来的结果集。<br>常见的一些选项和特性如下。</p>
<ul>
<li>能够标记游标为只读，使数据能读取，但不能更新和删除。</li>
<li>能控制可以执行的定向操作（向前、向后、第一、最后、绝对位置、相对位置等）。</li>
<li>能标记某些列为可编辑的，某些列为不可编辑的。</li>
<li>规定范围，使游标对创建它的特定请求（如存储过程）或对所有请求可访问。</li>
<li>指示DBMS对检索出的数据（而不是指出表中活动数据）进行复制，使数据在游标打开和访问期间不变化。</li>
<li>游标主要用于交互式应用，其中用户需要滚动屏幕上的数据，并对数据进行浏览或做出更改。</li>
</ul>
<h2 id="21-2-使用游标"><a href="#21-2-使用游标" class="headerlink" title="21.2 使用游标"></a>21.2 使用游标</h2><h3 id="21-2-1-创建游标"><a href="#21-2-1-创建游标" class="headerlink" title="21.2.1 创建游标"></a>21.2.1 创建游标</h3><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">DECLARE</span> CustCursor <span class="hljs-keyword">CURSOR</span>
<span class="hljs-keyword">FOR</span>
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> Customers
<span class="hljs-keyword">WHERE</span> cust_email <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span></code></pre></div>

<h3 id="21-2-2-使用游标"><a href="#21-2-2-使用游标" class="headerlink" title="21.2.2 使用游标"></a>21.2.2 使用游标</h3><p>使用<code>OPEN CURSOR</code>语句打开游标</p>
<div class="hljs"><pre><code class="hljs sql">OPEN CURSOR CustCursor</code></pre></div>

<p>用<code>FETCH</code>语句访问游标数据</p>
<div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">DECLARE</span> <span class="hljs-keyword">TYPE</span> CustCursor <span class="hljs-keyword">IS</span> <span class="hljs-keyword">REF</span> <span class="hljs-keyword">CURSOR</span>
	<span class="hljs-keyword">RETURN</span> Customers%ROWTYPE;
<span class="hljs-keyword">DECLARE</span> CustRecord Customers%ROWTYPE
<span class="hljs-keyword">BEGIN</span>
	<span class="hljs-keyword">OPEN</span> CustCursor;
	FETCH CustCursor INTO CustRecord;
	CLOSE CustCursor;
<span class="hljs-keyword">END</span>;</code></pre></div>

<h3 id="21-2-3-关闭游标"><a href="#21-2-3-关闭游标" class="headerlink" title="21.2.3 关闭游标"></a>21.2.3 关闭游标</h3><div class="hljs"><pre><code class="hljs sql">CLOSE CustCursor</code></pre></div>

<h1 id="二十二、高级SQL特性"><a href="#二十二、高级SQL特性" class="headerlink" title="二十二、高级SQL特性"></a>二十二、高级SQL特性</h1><h2 id="22-1-约束"><a href="#22-1-约束" class="headerlink" title="22.1 约束"></a>22.1 约束</h2><p>管理如何插入或处理数据库数据的规则</p>
<h3 id="22-1-1-主键"><a href="#22-1-1-主键" class="headerlink" title="22.1.1 主键"></a>22.1.1 主键</h3><p>表中任意列只要满足以下条件，都可以用于主键：<br>    • 任意两行的主键值都不相同。<br>    • 每行都具有一个主键值（即列中不允许NULL值）。<br>    • 包含主键值的列从不修改或更新。（大多数DBMS不允许这么做，但如果你使用的DBMS允许这样做，好吧，千万别！）<br>    • 主键值不能重用。如果从表中删除某一行，其主键值不分配给新行。</p>
<h3 id="22-1-2-外键"><a href="#22-1-2-外键" class="headerlink" title="22.1.2 外键"></a>22.1.2 外键</h3><p>外键是表中的一列，其值必须列在另一表的主键中<br>定义外键：</p>
<div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> Orders
(
	order_num <span class="hljs-built_in">INTEGER</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> PRIMARY <span class="hljs-keyword">KEY</span>,
	order_date DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
	cust_id <span class="hljs-built_in">CHAR</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">REFERENCES</span> Customers(cust_id)
);</code></pre></div>

<p><code>REFERENCES</code>关键字，它表示<code>cust_id</code>中的任何值都必须是<code>Customers</code>表的<code>cust_id</code>中的值。<br>相同的工作也可以在<code>ALTER TABLE</code>语句中用<code>CONSTRAINT</code>语法来完成：</p>
<div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> Orders
<span class="hljs-keyword">ADD</span> <span class="hljs-keyword">CONSTRAINT</span>
<span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">KEY</span> (cust_id) <span class="hljs-keyword">REFERENCES</span> Customers (cust_id)</code></pre></div>

<p>在定义外键后，DBMS不允许删除在另一个表中具有关联行的行。例如，不能删除关联订单的顾客。删除该顾客的唯一方法是首先删除相关的订单。</p>

            </article>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/">语言相关</a>
                    
                      <a class="hover-with-bg" href="/categories/%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3/SQL/">SQL</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/SQL/">SQL</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" target="_blank" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                      <a href="/2021/05/30/Spring%E4%B8%AD%E7%94%A8%E5%88%B0%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Spring中用到的设计模式</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/2021/05/30/Git%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4/">
                        <span class="hidden-mobile">Git常用指令</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

            
              <!-- Comments -->
              <div class="comments" id="comments">
                
                
  <script defer src="https://utteranc.es/client.js"
          repo="gavin-yyj/commit-utterance"
          issue-term="pathname"
  
          theme="github-light"
          crossorigin="anonymous"
  >
  </script>


              </div>
            
          </div>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener">
        <span>Fluid</span></a>
    </div>
    

    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>







  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '.post-content',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "SQL必知必会&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>







  
  
    <script type="text/javascript">
      //定义获取词语下标
      var a_idx = 0;
      jQuery(document).ready(function ($) {
        //点击body时触发事件
        $("body").click(function (e) {
          //需要显示的词语
          var a = new Array("富强", "民主", "文明", "和谐", "自由", "平等", "公正", "法治", "爱国", "敬业", "诚信", "友善");
          //设置词语给span标签
          var $i = $("<span/>").text(a[a_idx]);
          //下标等于原来下标+1  余 词语总数
          a_idx = (a_idx + 1) % a.length;
          //获取鼠标指针的位置，分别相对于文档的左和右边缘。
          //获取x和y的指针坐标
          var x = e.pageX, y = e.pageY;
          //在鼠标的指针的位置给$i定义的span标签添加css样式
          $i.css({
            "z-index": 999,
            "top": y - 20,
            "left": x,
            "position": "absolute",
            "font-weight": "bold",
            "color": rand_color()
          });
          // 随机颜色
          function rand_color() {
            return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")"
          }
          //在body添加这个标签
          $("body").append($i);
          //animate() 方法执行 CSS 属性集的自定义动画。
          //该方法通过CSS样式将元素从一个状态改变为另一个状态。CSS属性值是逐渐改变的，这样就可以创建动画效果。
          //详情请看http://www.w3school.com.cn/jquery/effect_animate.asp
          $i.animate({
            //将原来的位置向上移动180
            "top": y - 180,
            "opacity": 0
            //1500动画的速度
          }, 1500, function () {
            //时间到了自动删除
            $i.remove();
          });
        });
      })
      ;
    </script>
  














</body>
</html>
